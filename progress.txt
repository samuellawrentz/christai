---
Task: Create database migrations for new columns and tables
Status: done
Learnings: 
- Supabase MCP tools allow direct migration application without CLI
- Partial migrations need idempotent recovery migrations (IF NOT EXISTS, DROP IF EXISTS)
- is_deleted column already existed from prior incomplete migration
- Created fix migration to safely apply remaining components
- RLS policies created: conversations_not_deleted filters SELECT, conversation_shares has full CRUD policies
- All migrations applied successfully, typecheck passes
---
Task: Add conversation sharing endpoints - create share and public view
Status: done
Learnings:
- Public routes must be registered BEFORE authPlugin in Elysia app chain
- Use separate unauthenticated Supabase client (anon key only) for public endpoints
- Supabase FK relations return objects, but TS inference thinks arrays - cast via `as unknown as Type`
- Check for existing active share before creating new one (idempotent pattern)
- crypto.randomUUID().slice(0,8) gives 8-char short token
---
Task: Add DELETE, PATCH, and bookmark endpoints for conversations
Status: done
Learnings:
- DELETE, PATCH, and bookmark endpoints were already implemented in prior sharing commit
- Only missing piece was is_bookmarked field in Conversation type definition
- All endpoints follow consistent .update().eq('id', id).select().single() pattern
- Bookmark endpoint fetches current state first then toggles - ensures idempotent behavior
- Title validation checks for empty/whitespace-only strings before update
